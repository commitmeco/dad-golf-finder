<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Club Alert System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .quick-templates {
            background: linear-gradient(135deg, #e8f4f8 0%, #f0f8ff 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #3498db;
        }

        .quick-templates h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .template-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .template-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .template-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .alert-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .alert-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #34495e;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input.valid {
            border-color: #28a745;
        }

        .form-group input.invalid {
            border-color: #dc3545;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .location-group {
            position: relative;
        }

        .location-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .location-btn:hover {
            background: #5a67d8;
        }

        .validation-message {
            font-size: 0.8em;
            margin-top: 5px;
            padding: 5px;
            border-radius: 4px;
        }

        .validation-success {
            color: #28a745;
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }

        .validation-error {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }

        .validation-info {
            color: #0c5460;
            background: #d1ecf1;
            border: 1px solid #bee5eb;
        }

        .price-range {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .price-slider {
            flex: 1;
            margin: 0 10px;
        }

        .price-display {
            font-weight: bold;
            color: #2c3e50;
            min-width: 80px;
            text-align: center;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(46, 204, 113, 0.3);
        }

        .btn-tertiary {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }

        .btn-tertiary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(243, 156, 18, 0.3);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 6px;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .favorites-section {
            margin-top: 30px;
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .favorites-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .favorites-section h2 {
            color: #2c3e50;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bulk-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .select-all {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
            color: #666;
        }

        .favorite-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .favorite-item.selected {
            background: #e8f4f8;
            border-left-color: #3498db;
        }

        .favorite-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .favorite-details {
            flex: 1;
        }

        .favorite-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .favorite-params {
            color: #6c757d;
            font-size: 0.9em;
        }

        .favorite-actions {
            display: flex;
            gap: 10px;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-weight: 600;
            text-align: center;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #cce8ff;
            color: #004085;
            border: 1px solid #b8daff;
        }

        .auto-save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.9em;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }

        .duplicate-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .email-preview {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border-left: 5px solid #28a745;
        }

        .email-preview h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .email-content {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin: 0;
        }

        .close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #000;
        }

        .alert-badge {
            background: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .no-favorites {
            text-align: center;
            color: #6c757d;
            padding: 30px;
            font-style: italic;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8em;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }

            .template-buttons {
                justify-content: center;
            }

            .favorites-header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîî Golf Club Alert System</h1>
            <p>Get notified when your dream golf clubs go on sale</p>
            <div style="margin-top: 15px; font-size: 0.9em; opacity: 0.8;">
                Made with ‚ù§Ô∏è by <strong>Commit Me Co Design</strong>
            </div>
        </div>

        <div class="main-content">
            <!-- Quick Templates Section -->
            <div class="quick-templates">
                <h3>‚ö° Quick Templates</h3>
                <div class="template-buttons">
                    <button class="template-btn" onclick="applyTemplate('budget-driver')">Budget Driver ($100-300)</button>
                    <button class="template-btn" onclick="applyTemplate('premium-irons')">Premium Irons ($400-800)</button>
                    <button class="template-btn" onclick="applyTemplate('beginner-set')">Beginner Complete Set</button>
                    <button class="template-btn" onclick="applyTemplate('titleist-any')">Any Titleist Club</button>
                    <button class="template-btn" onclick="applyTemplate('wedge-deals')">Wedge Deals Under $150</button>
                </div>
            </div>

            <div class="alert-section">
                <h2>Create New Alert</h2>
                <form id="alertForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="alertName">
                                Alert Name 
                                <span class="tooltip">‚ÑπÔ∏è
                                    <span class="tooltiptext">Give your alert a memorable name like "Titleist Driver Under $300"</span>
                                </span>
                            </label>
                            <input type="text" id="alertName" name="alertName" placeholder="e.g., Titleist Driver Under $300" required>
                            <div id="nameValidation" class="validation-message"></div>
                        </div>

                        <div class="form-group">
                            <label for="clubType">Club Type</label>
                            <select id="clubType" name="clubType">
                                <option value="">All Types</option>
                                <option value="driver">Driver</option>
                                <option value="irons">Iron Set</option>
                                <option value="wedges">Wedges</option>
                                <option value="putter">Putter</option>
                                <option value="hybrid">Hybrid</option>
                                <option value="fairway">Fairway Wood</option>
                                <option value="complete">Complete Set</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="brand">Brand</label>
                            <select id="brand" name="brand">
                                <option value="">Any Brand</option>
                                <option value="titleist">Titleist</option>
                                <option value="callaway">Callaway</option>
                                <option value="taylormade">TaylorMade</option>
                                <option value="ping">Ping</option>
                                <option value="mizuno">Mizuno</option>
                                <option value="cobra">Cobra</option>
                                <option value="cleveland">Cleveland</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="priceRange">
                                Price Range 
                                <span class="tooltip">üí∞
                                    <span class="tooltiptext">Use the slider to set your budget range</span>
                                </span>
                            </label>
                            <div class="price-range">
                                <span class="price-display" id="minPriceDisplay">$0</span>
                                <input type="range" id="minPriceSlider" min="0" max="2000" value="0" step="25" class="price-slider">
                                <span style="margin: 0 10px;">to</span>
                                <input type="range" id="maxPriceSlider" min="0" max="2000" value="1000" step="25" class="price-slider">
                                <span class="price-display" id="maxPriceDisplay">$1000</span>
                            </div>
                            <input type="hidden" id="minPrice" name="minPrice" value="0">
                            <input type="hidden" id="maxPrice" name="maxPrice" value="1000">
                        </div>

                        <div class="form-group location-group">
                            <label for="location">
                                Location 
                                <span class="tooltip">üìç
                                    <span class="tooltiptext">Enter city/state, zipcode, or click "Use My Location"</span>
                                </span>
                            </label>
                            <input type="text" id="location" name="location" placeholder="e.g., Lorain, OH or 44052">
                            <button type="button" class="location-btn" onclick="useMyLocation()">üìç Use My Location</button>
                            <div id="locationValidation" class="validation-message"></div>
                        </div>

                        <div class="form-group">
                            <label for="radius">Search Radius</label>
                            <select id="radius" name="radius">
                                <option value="10">10 miles</option>
                                <option value="25">25 miles</option>
                                <option value="50" selected>50 miles</option>
                                <option value="100">100 miles</option>
                                <option value="200">200 miles</option>
                                <option value="nationwide">Nationwide</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="keywords">Keywords (optional)</label>
                            <input type="text" id="keywords" name="keywords" placeholder="e.g., like new, barely used, mint condition">
                        </div>

                        <div class="form-group">
                            <label for="notes">Notes (optional)</label>
                            <textarea id="notes" name="notes" placeholder="Additional notes about what you're looking for..."></textarea>
                        </div>
                    </div>

                    <div id="duplicateWarning" class="duplicate-warning">
                        ‚ö†Ô∏è <strong>Duplicate Alert Detected:</strong> You already have a similar alert. Consider updating your existing alert instead.
                    </div>

                    <div class="buttons">
                        <button type="button" class="btn btn-primary" onclick="createAlert()">
                            üîî Alert Me When Found
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="previewAlert()">
                            üìß Preview Alert Email
                        </button>
                        <button type="button" class="btn btn-tertiary" onclick="testAlert()">
                            üß™ Test Alert (Demo)
                        </button>
                    </div>
                </form>
            </div>

            <div id="statusMessage"></div>

            <div class="favorites-section">
                <div class="favorites-header">
                    <h2>
                        ‚≠ê My Alerts
                        <span id="alertCount" class="alert-badge">0</span>
                    </h2>
                    <div class="bulk-actions">
                        <label class="select-all">
                            <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                            Select All
                        </label>
                        <button class="btn btn-danger btn-small" onclick="bulkDelete()" id="bulkDeleteBtn" style="display: none;">
                            üóëÔ∏è Delete Selected
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="bulkTest()" id="bulkTestBtn" style="display: none;">
                            üß™ Test Selected
                        </button>
                    </div>
                </div>
                <div id="favoritesContainer">
                    <div class="no-favorites">
                        <p>No alerts created yet. Create your first alert above!</p>
                    </div>
                </div>
            </div>

            <div id="emailPreview" class="email-preview" style="display: none;">
                <h3>üìß Email Preview</h3>
                <div class="email-content" id="emailContent"></div>
            </div>
        </div>
    </div>

    <!-- Auto-save indicator -->
    <div id="autoSaveIndicator" class="auto-save-indicator">
        üíæ Draft saved automatically
    </div>

    <!-- Modal for alert details -->
    <div id="alertModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Alert Details</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // In-memory storage for alerts and draft
        let savedAlerts = [];
        let alertIdCounter = 1;
        let autoSaveTimeout;
        let draftData = {};

        // Quick templates
        const templates = {
            'budget-driver': {
                alertName: 'Budget Driver Deal',
                clubType: 'driver',
                brand: '',
                minPrice: 100,
                maxPrice: 300,
                location: '',
                radius: '50',
                keywords: 'good condition, barely used',
                notes: 'Looking for a quality driver at a great price'
            },
            'premium-irons': {
                alertName: 'Premium Iron Set',
                clubType: 'irons',
                brand: '',
                minPrice: 400,
                maxPrice: 800,
                location: '',
                radius: '100',
                keywords: 'excellent condition, steel shaft',
                notes: 'High-end iron set for serious golfers'
            },
            'beginner-set': {
                alertName: 'Beginner Complete Set',
                clubType: 'complete',
                brand: '',
                minPrice: 0,
                maxPrice: 400,
                location: '',
                radius: '50',
                keywords: 'complete set, bag included',
                notes: 'Perfect starter set for new golfers'
            },
            'titleist-any': {
                alertName: 'Any Titleist Club',
                clubType: '',
                brand: 'titleist',
                minPrice: 0,
                maxPrice: 1000,
                location: '',
                radius: '100',
                keywords: 'authentic, genuine',
                notes: 'Looking for quality Titleist equipment'
            },
            'wedge-deals': {
                alertName: 'Wedge Deals Under $150',
                clubType: 'wedges',
                brand: '',
                minPrice: 0,
                maxPrice: 150,
                location: '',
                radius: '50',
                keywords: 'good grooves, clean face',
                notes: 'Need wedges for short game improvement'
            }
        };

        // Mock listings for demo
        const mockListings = [
            {
                id: 1,
                title: "TaylorMade SIM2 Driver - Excellent Condition",
                price: "$275",
                location: "Elyria, OH (44035)",
                source: "Craigslist",
                details: "10.5¬∞ loft, Fujikura Ventus shaft, barely used. Great for long drives.",
                url: "https://cleveland.craigslist.org/spo/d/demo-listing-1/1234567890.html",
                posted: "2 hours ago"
            },
            {
                id: 2,
                title: "Titleist AP2 Iron Set 4-PW - Like New",
                price: "$450",
                location: "Sheffield Lake, OH (44054)",
                source: "Facebook Marketplace",
                details: "Dynamic Gold S300 shafts, excellent condition. Perfect for mid-handicappers.",
                url: "https://facebook.com/marketplace/item/demo-listing-2",
                posted: "1 day ago"
            },
            {
                id: 3,
                title: "Ping G425 Hybrid 22¬∞ - Mint Condition",
                price: "$125",
                location: "Avon, OH (44011)",
                source: "eBay",
                details: "Alta CB Red shaft, senior flex. Very forgiving club for approach shots.",
                url: "https://ebay.com/itm/demo-listing-3",
                posted: "3 hours ago"
            }
        ];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            setupPriceSliders();
            setupFormValidation();
            setupAutoSave();
            loadDraft();
            displayFavorites();
            
            // Set default location
            document.getElementById('location').value = 'Lorain, OH';
            validateLocation();
        });

        // **IMPROVEMENT 1: Quick Templates**
        function applyTemplate(templateKey) {
            const template = templates[templateKey];
            if (!template) return;

            Object.keys(template).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = template[key];
                    if (key === 'minPrice' || key === 'maxPrice') {
                        updatePriceSliders();
                    }
                }
            });

            // Trigger validation
            validateForm();
            showStatusMessage(`Template "${template.alertName}" applied! Customize as needed.`, 'info');
        }

        // **IMPROVEMENT 2: Auto-fill Location from Geolocation**
        function useMyLocation() {
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'üìç Getting...';
            btn.disabled = true;

            if (!navigator.geolocation) {
                showStatusMessage('Geolocation is not supported by this browser.', 'error');
                btn.textContent = originalText;
                btn.disabled = false;
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async function(position) {
                    try {
                        // In a real app, you'd use a geocoding service here
                        // For demo, we'll simulate getting the location
                        const mockLocation = "Lorain, OH 44052";
                        document.getElementById('location').value = mockLocation;
                        validateLocation();
                        showStatusMessage('Location updated successfully!', 'success');
                    } catch (error) {
                        showStatusMessage('Unable to get location details.', 'error');
                    }
                    btn.textContent = originalText;
                    btn.disabled = false;
                },
                function(error) {
                    showStatusMessage('Unable to get your location. Please enter manually.', 'error');
                    btn.textContent = originalText;
                    btn.disabled = false;
                }
            );
        }

        // **IMPROVEMENT 3: Auto-save Draft**
        function setupAutoSave() {
            const form = document.getElementById('alertForm');
            const inputs = form.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    clearTimeout(autoSaveTimeout);
                    autoSaveTimeout = setTimeout(saveDraft, 1000);
                });
            });
        }

        function saveDraft() {
            const formData = new FormData(document.getElementById('alertForm'));
            draftData = Object.fromEntries(formData);
            
            // Show auto-save indicator
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        function loadDraft() {
            if (Object.keys(draftData).length === 0) return;
            
            Object.keys(draftData).forEach(key => {
                const element = document.getElementById(key);
                if (element && draftData[key]) {
                    element.value = draftData[key];
                }
            });
            
            updatePriceSliders();
        }

        // **IMPROVEMENT 4: Smart Form Validation**
        function setupFormValidation() {
            const alertNameInput = document.getElementById('alertName');
            const locationInput = document.getElementById('location');
            
            alertNameInput.addEventListener('input', validateAlertName);
            locationInput.addEventListener('input', validateLocation);
        }

        function validateAlertName() {
            const input = document.getElementById('alertName');
            const validation = document.getElementById('nameValidation');
            const value = input.value.trim();
            
            if (value.length === 0) {
                validation.textContent = '';
                input.classList.remove('valid', 'invalid');
                return;
            }
            
            if (value.length < 5) {
                validation.textContent = 'Alert name should be at least 5 characters';
                validation.className = 'validation-message validation-error';
                input.classList.add('invalid');
                input.classList.remove('valid');
            } else {
                validation.textContent = 'Good alert name!';
                validation.className = 'validation-message validation-success';
                input.classList.add('valid');
                input.classList.remove('invalid');
            }
        }

        function validateLocation() {
            const input = document.getElementById('location');
            const validation = document.getElementById('locationValidation');
            const value = input.value.trim();
            
            if (value.length === 0) {
                validation.textContent = '';
                input.classList.remove('valid', 'invalid');
                return;
            }
            
            // Check if it's a zipcode (5 digits)
            const zipcodeRegex = /^\d{5}$/;
            // Check if it's city, state format
            const cityStateRegex = /^[a-zA-Z\s]+,\s*[a-zA-Z]{2}$/;
            
            if (zipcodeRegex.test(value)) {
                validation.textContent = 'Valid zipcode format';
                validation.className = 'validation-message validation-success';
                input.classList.add('valid');
                input.classList.remove('invalid');
            } else if (cityStateRegex.test(value)) {
                validation.textContent = 'Valid city, state format';
                validation.className = 'validation-message validation-success';
                input.classList.add('valid');
                input.classList.remove('invalid');
            } else {
                validation.textContent = 'Use format: "City, ST" or "12345" (zipcode)';
                validation.className = 'validation-message validation-info';
                input.classList.remove('valid', 'invalid');
            }
        }

        function validateForm() {
            validateAlertName();
            validateLocation();
        }

        // **IMPROVEMENT 5: Duplicate Alert Detection**
        function checkForDuplicates(alertData) {
            const duplicate = savedAlerts.find(alert => 
                alert.name.toLowerCase() === alertData.alertName.toLowerCase() ||
                (alert.clubType === alertData.clubType && 
                 alert.brand === alertData.brand && 
                 alert.minPrice === alertData.minPrice && 
                 alert.maxPrice === alertData.maxPrice)
            );
            
            const warning = document.getElementById('duplicateWarning');
            if (duplicate) {
                warning.style.display = 'block';
                return true;
            } else {
                warning.style.display = 'none';
                return false;
            }
        }

        // Price slider functionality
        function setupPriceSliders() {
            const minSlider = document.getElementById('minPriceSlider');
            const maxSlider = document.getElementById('maxPriceSlider');
            const minDisplay = document.getElementById('minPriceDisplay');
            const maxDisplay = document.getElementById('maxPriceDisplay');
            const minHidden = document.getElementById('minPrice');
            const maxHidden = document.getElementById('maxPrice');

            function updatePrices() {
                let minVal = parseInt(minSlider.value);
                let maxVal = parseInt(maxSlider.value);
                
                if (minVal >= maxVal) {
                    minVal = maxVal - 25;
                    minSlider.value = minVal;
                }
                
                minDisplay.textContent = `$${minVal}`;
                maxDisplay.textContent = `$${maxVal}`;
                minHidden.value = minVal;
                maxHidden.value = maxVal;
            }

            minSlider.addEventListener('input', updatePrices);
            maxSlider.addEventListener('input', updatePrices);
            
            updatePrices();
        }

        function updatePriceSliders() {
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            
            if (minPrice) document.getElementById('minPriceSlider').value = minPrice;
            if (maxPrice) document.getElementById('maxPriceSlider').value = maxPrice;
            
            const minDisplay = document.getElementById('minPriceDisplay');
            const maxDisplay = document.getElementById('maxPriceDisplay');
            minDisplay.textContent = `$${minPrice || 0}`;
            maxDisplay.textContent = `$${maxPrice || 1000}`;
        }

        // **IMPROVEMENT 6: Bulk Actions**
        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.favorite-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
                toggleFavoriteSelection(checkbox);
            });
            
            updateBulkActions();
        }

        function toggleFavoriteSelection(checkbox) {
            const favoriteItem = checkbox.closest('.favorite-item');
            if (checkbox.checked) {
                favoriteItem.classList.add('selected');
            } else {
                favoriteItem.classList.remove('selected');
            }
            updateBulkActions();
        }

        function updateBulkActions() {
            const selectedCount = document.querySelectorAll('.favorite-checkbox:checked').length;
            const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
            const bulkTestBtn = document.getElementById('bulkTestBtn');
            
            if (selectedCount > 0) {
                bulkDeleteBtn.style.display = 'inline-flex';
                bulkTestBtn.style.display = 'inline-flex';
            } else {
                bulkDeleteBtn.style.display = 'none';
                bulkTestBtn.style.display = 'none';
            }
        }

        function bulkDelete() {
            const selectedCheckboxes = document.querySelectorAll('.favorite-checkbox:checked');
            const selectedIds = Array.from(selectedCheckboxes).map(cb => parseInt(cb.dataset.alertId));
            
            if (selectedIds.length === 0) return;
            
            if (confirm(`Are you sure you want to delete ${selectedIds.length} alert(s)?`)) {
                savedAlerts = savedAlerts.filter(alert => !selectedIds.includes(alert.id));
                displayFavorites();
                showStatusMessage(`${selectedIds.length} alert(s) deleted successfully`, 'success');
            }
        }

        function bulkTest() {
            const selectedCheckboxes = document.querySelectorAll('.favorite-checkbox:checked');
            const selectedIds = Array.from(selectedCheckboxes).map(cb => parseInt(cb.dataset.alertId));
            
            if (selectedIds.length === 0) return;
            
            const selectedAlerts = savedAlerts.filter(alert => selectedIds.includes(alert.id));
            const combinedListings = mockListings.slice(0, 2); // Demo listings
            
            const emailHTML = generateBulkTestEmail(selectedAlerts, combinedListings);
            showEmailPreview(emailHTML);
            showStatusMessage(`Bulk test email generated for ${selectedIds.length} alert(s)`, 'info');
        }

        function generateBulkTestEmail(alerts, listings) {
            const currentDate = new Date().toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            return `
                <div style="font-family: 'Segoe UI', Arial, sans-serif; max-width: 600px; margin: 0 auto; background: #f8f9fa; padding: 20px;">
                    <div style="background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                        <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 30px; text-align: center;">
                            <h1 style="margin: 0; font-size: 2.2em;">üèåÔ∏è Multiple Alert Summary</h1>
                            <p style="margin: 10px 0 0 0; font-size: 1.1em;">Updates for ${alerts.length} alerts</p>
                        </div>
                        
                        <div style="padding: 25px;">
                            <h3 style="color: #2c3e50; margin-bottom: 20px;">üìÖ ${currentDate}</h3>
                            
                            ${alerts.map(alert => `
                                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 15px; border-left: 4px solid #667eea;">
                                    <h4 style="margin: 0 0 10px 0; color: #2c3e50;">${alert.name}</h4>
                                    <p style="margin: 0; color: #666; font-size: 0.9em;">Found ${listings.length} potential matches</p>
                                </div>
                            `).join('')}
                            
                            <div style="margin-top: 30px;">
                                <h3 style="color: #2c3e50; margin-bottom: 15px;">üéØ Sample Matches</h3>
                                ${listings.map(listing => `
                                    <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                        <h4 style="margin: 0 0 5px 0; color: #2c3e50;">${listing.title}</h4>
                                        <p style="margin: 0 0 10px 0; font-size: 1.2em; font-weight: bold; color: #e74c3c;">${listing.price}</p>
                                        <p style="margin: 0; color: #666; font-size: 0.9em;">üìç ${listing.location} ‚Ä¢ ${listing.source}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 25px; text-align: center; border-top: 1px solid #dee2e6;">
                            <p style="margin: 0 0 15px 0; font-size: 1.1em; color: #2c3e50;">
                                <strong>Happy Golfing! üèåÔ∏è‚Äç‚ôÇÔ∏è</strong>
                            </p>
                            <p style="margin: 0; font-size: 0.9em; color: #666;">
                                Golf Club Alert System - Managing ${alerts.length} alerts for you
                            </p>
                            <p style="margin: 8px 0 0 0; font-size: 0.75em; color: #bbb;">
                                Crafted with ‚ù§Ô∏è by <strong>Commit Me Co Design</strong>
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Main alert functions
        function createAlert() {
            const formData = new FormData(document.getElementById('alertForm'));
            const alertData = Object.fromEntries(formData);
            
            if (!alertData.alertName.trim()) {
                showStatusMessage('Please enter an alert name', 'error');
                return;
            }

            // Check for duplicates
            if (checkForDuplicates(alertData)) {
                showStatusMessage('Duplicate alert detected. Please modify your criteria or name.', 'error');
                return;
            }

            const newAlert = {
                id: alertIdCounter++,
                name: alertData.alertName,
                clubType: alertData.clubType,
                brand: alertData.brand,
                minPrice: alertData.minPrice,
                maxPrice: alertData.maxPrice,
                location: alertData.location,
                radius: alertData.radius,
                keywords: alertData.keywords,
                notes: alertData.notes,
                createdAt: new Date().toISOString(),
                active: true
            };

            savedAlerts.push(newAlert);
            
            // Clear form and draft
            document.getElementById('alertForm').reset();
            draftData = {};
            setupPriceSliders();
            
            displayFavorites();
            showStatusMessage(`Alert "${newAlert.name}" created successfully! You'll be notified when matching clubs are found.`, 'success');
        }

        function displayFavorites() {
            const container = document.getElementById('favoritesContainer');
            const countBadge = document.getElementById('alertCount');
            
            countBadge.textContent = savedAlerts.length;
            
            if (savedAlerts.length === 0) {
                container.innerHTML = `
                    <div class="no-favorites">
                        <p>No alerts created yet. Create your first alert above!</p>
                    </div>
                `;
                return;
            }

            const favoritesHTML = savedAlerts.map(alert => {
                const params = [];
                if (alert.clubType) params.push(`Type: ${alert.clubType}`);
                if (alert.brand) params.push(`Brand: ${alert.brand}`);
                if (alert.minPrice) params.push(`Min: $${alert.minPrice}`);
                if (alert.maxPrice) params.push(`Max: $${alert.maxPrice}`);
                if (alert.location) params.push(`Location: ${alert.location}`);
                
                return `
                    <div class="favorite-item">
                        <input type="checkbox" class="favorite-checkbox" data-alert-id="${alert.id}" onchange="toggleFavoriteSelection(this)">
                        <div class="favorite-details">
                            <div class="favorite-title">${alert.name}</div>
                            <div class="favorite-params">${params.join(' ‚Ä¢ ') || 'No specific filters'}</div>
                        </div>
                        <div class="favorite-actions">
                            <button class="btn btn-info btn-small" onclick="viewAlert(${alert.id})">
                                View
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="testSpecificAlert(${alert.id})">
                                Test
                            </button>
                            <button class="btn btn-danger btn-small" onclick="deleteAlert(${alert.id})">
                                Delete
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = favoritesHTML;
        }

        function deleteAlert(alertId) {
            if (confirm('Are you sure you want to delete this alert?')) {
                savedAlerts = savedAlerts.filter(alert => alert.id !== alertId);
                displayFavorites();
                showStatusMessage('Alert deleted successfully', 'success');
            }
        }

        function viewAlert(alertId) {
            const alert = savedAlerts.find(a => a.id === alertId);
            if (!alert) return;

            const modalContent = `
                <h4>${alert.name}</h4>
                <p><strong>Club Type:</strong> ${alert.clubType || 'Any'}</p>
                <p><strong>Brand:</strong> ${alert.brand || 'Any'}</p>
                <p><strong>Price Range:</strong> $${alert.minPrice || '0'} - $${alert.maxPrice || '‚àû'}</p>
                <p><strong>Location:</strong> ${alert.location || 'Not specified'}</p>
                <p><strong>Radius:</strong> ${alert.radius || '50'} miles</p>
                <p><strong>Keywords:</strong> ${alert.keywords || 'None'}</p>
                <p><strong>Notes:</strong> ${alert.notes || 'None'}</p>
                <p><strong>Created:</strong> ${new Date(alert.createdAt).toLocaleString()}</p>
                <p><strong>Status:</strong> ${alert.active ? 'üü¢ Active' : 'üî¥ Inactive'}</p>
            `;

            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('alertModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('alertModal').style.display = 'none';
        }

        function testSpecificAlert(alertId) {
            const alert = savedAlerts.find(a => a.id === alertId);
            if (!alert) return;

            const matchingListings = mockListings.filter(listing => {
                let matches = true;
                
                if (alert.clubType && !listing.title.toLowerCase().includes(alert.clubType.toLowerCase())) {
                    matches = false;
                }
                
                if (alert.brand && !listing.title.toLowerCase().includes(alert.brand.toLowerCase())) {
                    matches = false;
                }
                
                if (alert.minPrice) {
                    const price = parseInt(listing.price.replace('$', ''));
                    if (price < parseInt(alert.minPrice)) matches = false;
                }
                
                if (alert.maxPrice) {
                    const price = parseInt(listing.price.replace('$', ''));
                    if (price > parseInt(alert.maxPrice)) matches = false;
                }
                
                return matches;
            });

            const emailHTML = generateAlertEmailHTML(alert, matchingListings);
            showEmailPreview(emailHTML);
            
            showStatusMessage(`Test email generated for "${alert.name}" - Found ${matchingListings.length} matching listing(s)`, 'info');
        }

        function testAlert() {
            const formData = new FormData(document.getElementById('alertForm'));
            const alertData = Object.fromEntries(formData);
            
            if (!alertData.alertName.trim()) {
                showStatusMessage('Please enter an alert name to test', 'error');
                return;
            }

            const tempAlert = {
                name: alertData.alertName,
                clubType: alertData.clubType,
                brand: alertData.brand,
                minPrice: alertData.minPrice,
                maxPrice: alertData.maxPrice,
                location: alertData.location,
                radius: alertData.radius,
                keywords: alertData.keywords,
                notes: alertData.notes
            };

            const matchingListings = mockListings.filter(listing => {
                let matches = true;
                
                if (tempAlert.clubType && !listing.title.toLowerCase().includes(tempAlert.clubType.toLowerCase())) {
                    matches = false;
                }
                
                if (tempAlert.brand && !listing.title.toLowerCase().includes(tempAlert.brand.toLowerCase())) {
                    matches = false;
                }
                
                return matches;
            });

            const emailHTML = generateAlertEmailHTML(tempAlert, matchingListings);
            showEmailPreview(emailHTML);
            
            showStatusMessage(`Test email generated - Found ${matchingListings.length} matching listing(s)`, 'info');
        }

        function previewAlert() {
            const formData = new FormData(document.getElementById('alertForm'));
            const alertData = Object.fromEntries(formData);
            
            if (!alertData.alertName.trim()) {
                showStatusMessage('Please enter an alert name to preview', 'error');
                return;
            }

            const tempAlert = {
                name: alertData.alertName,
                clubType: alertData.clubType,
                brand: alertData.brand,
                minPrice: alertData.minPrice,
                maxPrice: alertData.maxPrice,
                location: alertData.location,
                radius: alertData.radius,
                keywords: alertData.keywords,
                notes: alertData.notes
            };

            const emailHTML = generateAlertEmailHTML(tempAlert, mockListings.slice(0, 2));
            showEmailPreview(emailHTML);
            
            showStatusMessage('Email preview generated', 'info');
        }

        function generateAlertEmailHTML(alert, listings) {
            const filterSummary = [];
            if (alert.clubType) filterSummary.push(`Type: ${alert.clubType}`);
            if (alert.brand) filterSummary.push(`Brand: ${alert.brand}`);
            if (alert.minPrice) filterSummary.push(`Min: $${alert.minPrice}`);
            if (alert.maxPrice) filterSummary.push(`Max: $${alert.maxPrice}`);
            if (alert.location) filterSummary.push(`Location: ${alert.location}`);
            if (alert.keywords) filterSummary.push(`Keywords: ${alert.keywords}`);

            const currentDate = new Date().toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            return `
                <div style="font-family: 'Segoe UI', Arial, sans-serif; max-width: 600px; margin: 0 auto; background: #f8f9fa; padding: 20px;">
                    <div style="background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                        <!-- Header -->
                        <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 30px; text-align: center;">
                            <h1 style="margin: 0; font-size: 2.2em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">üèåÔ∏è Golf Club Alert</h1>
                            <p style="margin: 10px 0 0 0; font-size: 1.1em; opacity: 0.9;">New listings found for "${alert.name}"</p>
                        </div>

                        <!-- Alert Summary -->
                        <div style="padding: 25px; background: #e8f4f8; border-bottom: 1px solid #dee2e6;">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="background: #667eea; color: white; padding: 8px 12px; border-radius: 20px; font-size: 0.9em; font-weight: 600;">
                                    üìÖ ${currentDate}
                                </div>
                                <div style="margin-left: 15px; color: #28a745; font-weight: 600;">
                                    ${listings.length} New Listing${listings.length !== 1 ? 's' : ''} Found
                                </div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
                                <h3 style="margin: 0 0 10px 0; color: #2c3e50; font-size: 1.1em;">üîç Your Alert Criteria:</h3>
                                <p style="margin: 0; color: #666; font-size: 0.95em;">${filterSummary.join(' ‚Ä¢ ') || 'No specific filters'}</p>
                            </div>
                        </div>

                        <!-- Listings -->
                        <div style="padding: 25px;">
                            ${listings.length > 0 ? listings.map(listing => `
                                <div style="background: white; border: 2px solid #e9ecef; border-radius: 12px; margin-bottom: 20px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: all 0.3s ease;">
                                    <div style="padding: 20px;">
                                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                            <div style="flex: 1;">
                                                <h3 style="margin: 0 0 8px 0; color: #2c3e50; font-size: 1.3em; line-height: 1.3;">${listing.title}</h3>
                                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                                    <span style="background: #3498db; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.85em; font-weight: 600;">${listing.source}</span>
                                                    <span style="color: #7f8c8d; font-size: 0.9em;">üìç ${listing.location}</span>
                                                    <span style="color: #7f8c8d; font-size: 0.9em;">‚è∞ ${listing.posted}</span>
                                                </div>
                                            </div>
                                            <div style="text-align: right;">
                                                <div style="font-size: 1.8em; font-weight: 700; color: #e74c3c; margin-bottom: 5px;">${listing.price}</div>
                                            </div>
                                        </div>
                                        
                                        <p style="margin: 15px 0; color: #555; line-height: 1.6; font-size: 0.95em;">${listing.details}</p>
                                        
                                        <div style="text-align: center; margin-top: 20px;">
                                            <a href="${listing.url}" style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 30px; text-decoration: none; border-radius: 25px; font-weight: 600; font-size: 1em; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); transition: all 0.3s ease;">
                                                üîó View Listing
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            `).join('') : `
                                <div style="text-align: center; padding: 40px; color: #666;">
                                    <h3 style="margin: 0 0 10px 0;">No listings found at this time</h3>
                                    <p style="margin: 0;">We'll keep monitoring and notify you when matching clubs are available!</p>
                                </div>
                            `}
                        </div>

                        <!-- Footer -->
                        <div style="background: #f8f9fa; padding: 25px; text-align: center; border-top: 1px solid #dee2e6;">
                            <p style="margin: 0 0 15px 0; font-size: 1.1em; color: #2c3e50;">
                                <strong>Happy Golfing! üèåÔ∏è‚Äç‚ôÇÔ∏è</strong>
                            </p>
                            <p style="margin: 0; font-size: 0.9em; color: #666;">
                                This alert was sent to emily@commitme.co<br>
                                Golf Club Alert System - Your personal golf deal finder
                            </p>
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #dee2e6;">
                                <p style="margin: 0; font-size: 0.8em; color: #aaa;">
                                    üí° Tip: Act fast! The best deals don't last long.
                                </p>
                                <p style="margin: 8px 0 0 0; font-size: 0.75em; color: #bbb;">
                                    Crafted with ‚ù§Ô∏è by <strong>Commit Me Co Design</strong>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showEmailPreview(emailHTML) {
            const previewDiv = document.getElementById('emailPreview');
            const contentDiv = document.getElementById('emailContent');
            
            contentDiv.innerHTML = emailHTML;
            previewDiv.style.display = 'block';
            
            previewDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function showStatusMessage(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('alertModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>